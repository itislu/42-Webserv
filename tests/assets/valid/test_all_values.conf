# =====================================================
# Global config (Config)
# =====================================================

root /var/www/global/;
max_body_size 8192;
keepalive_timeout 120;

error_page 400 /errors/400.html;
error_page 404 /errors/404.html;
error_page 500 /errors/500.html;

# =====================================================
# Server 1
# =====================================================

server {
    listen 8080;
    listen 8081;
    server_name example.com www.example.com;
    root /var/www/example/;
    index index.html;
    max_body_size 4096;
    keepalive_timeout 90;

    error_page 403 /errors/403.html;
    error_page 502 /errors/502.html;

    # --- Allowed methods for this server (default for locations) ---
    allowed_methods GET POST DELETE;

    # --- Location 1: simple static content ---
    location / {
        root /var/www/example/public/;
        index index.html;
        autoindex on;
        allowed_methods GET;
        max_body_size 2048;
        error_page 404 /errors/custom_404.html;
    }

    # --- Location 2: uploads ---
    location /upload/ {
        root /var/www/example/uploads/;
        autoindex off;
        allowed_methods POST DELETE;
        max_body_size 8192;
        index upload.html;
    }

    # --- Location 3: CGI handler ---
    location /cgi-bin/ {
        root /var/www/example/cgi/;
        autoindex off;
        allowed_methods GET POST;
        cgi_enabled yes;
        cgi_pass /usr/bin/python3;
        cgi_extension .py;
        max_body_size 2048;
    }

    # --- Location 4: Redirect ---
    location /old/ {
        root /var/www/example/old/;
        autoindex no;
        redirect true;
        redirect_code 301;
        redirect_url http://example.com/new/;
    }
}

# =====================================================
# Server 2
# =====================================================

server {
    listen 9090;
    server_name api.example.com;
    root /var/www/api/;
    index index.html;
    max_body_size 16384;
    keepalive_timeout 60;

    allowed_methods GET POST;
    error_page 404 /errors/api_404.html;

    location / {
        root /var/www/api/root/;
        autoindex off;
        allowed_methods GET POST;
        index api_index.html;
        max_body_size 4096;
    }

    location /v1/ {
        root /var/www/api/v1/;
        autoindex off;
        allowed_methods GET POST DELETE;
        cgi_enabled on;
        cgi_pass /usr/bin/python3;
        cgi_extension .py;
    }
}
